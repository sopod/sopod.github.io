<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='절두체 컬링 절두체 컬링(Frustum culling) 절두체를 구성하는 6개의 평면에 대해 각각 평면의 방정식을 세우고, 그것을 활용해서 게임 오브젝트가 평면의 바깥에 있는지 확인한다. 바깥에 있다면, 그리지 않는다. 평면의 방정식 절두체를 구성하는 평면의 방정식
Chapter 8에서 살펴본 것처럼, 주어진 세 점으로 두 벡터를 생성해서 평면 상의 모든 점을 생성할 수 있다. 하지만 3차원 공간의 평면은 앞면과 뒷면이 존재하기 때문에 이를 구분할 수 있어야 하겠다. 따라서 평면이 바라보는 방향을 알려주는 법선 벡터와 평면 상에 위치한 한 점을 제공하는 방법을 사용한다.'><title>[Game Math] Chapter 13. 절두체: 최적화된 3차원 공간 (1)</title>

<link rel='canonical' href='https://sopod.github.io/p/game-math-13-1/'>

<link rel="stylesheet" href="/scss/style.min.ac77dcf8b111b51da39a92990f431923f210f3876d85798a2125667f96dc33a4.css"><meta property='og:title' content='[Game Math] Chapter 13. 절두체: 최적화된 3차원 공간 (1)'>
<meta property='og:description' content='절두체 컬링 절두체 컬링(Frustum culling) 절두체를 구성하는 6개의 평면에 대해 각각 평면의 방정식을 세우고, 그것을 활용해서 게임 오브젝트가 평면의 바깥에 있는지 확인한다. 바깥에 있다면, 그리지 않는다. 평면의 방정식 절두체를 구성하는 평면의 방정식
Chapter 8에서 살펴본 것처럼, 주어진 세 점으로 두 벡터를 생성해서 평면 상의 모든 점을 생성할 수 있다. 하지만 3차원 공간의 평면은 앞면과 뒷면이 존재하기 때문에 이를 구분할 수 있어야 하겠다. 따라서 평면이 바라보는 방향을 알려주는 법선 벡터와 평면 상에 위치한 한 점을 제공하는 방법을 사용한다.'>
<meta property='og:url' content='https://sopod.github.io/p/game-math-13-1/'>
<meta property='og:site_name' content='Sopod'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Game Math' /><meta property='article:published_time' content='2022-04-20T17:00:00&#43;09:00'/><meta property='article:modified_time' content='2022-04-20T17:00:00&#43;09:00'/>
<meta name="twitter:title" content="[Game Math] Chapter 13. 절두체: 최적화된 3차원 공간 (1)">
<meta name="twitter:description" content="절두체 컬링 절두체 컬링(Frustum culling) 절두체를 구성하는 6개의 평면에 대해 각각 평면의 방정식을 세우고, 그것을 활용해서 게임 오브젝트가 평면의 바깥에 있는지 확인한다. 바깥에 있다면, 그리지 않는다. 평면의 방정식 절두체를 구성하는 평면의 방정식
Chapter 8에서 살펴본 것처럼, 주어진 세 점으로 두 벡터를 생성해서 평면 상의 모든 점을 생성할 수 있다. 하지만 3차원 공간의 평면은 앞면과 뒷면이 존재하기 때문에 이를 구분할 수 있어야 하겠다. 따라서 평면이 바라보는 방향을 알려주는 법선 벡터와 평면 상에 위치한 한 점을 제공하는 방법을 사용한다.">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    <img src="/main.png" width="300" height="300" class="site-logo" loading="lazy" alt="Avatar">
                
                </a>
                
                    <span class="emoji">🍥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Sopod</a></h1>
            <h2 class="site-description">Always hungry to keep learning.</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/sopod'
                        target="_blank"
                        title="GitHub"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/game-math/" >
                Game Math
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/game-math-13-1/">[Game Math] Chapter 13. 절두체: 최적화된 3차원 공간 (1)</a>
        </h2>
    
        
    </div>

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Apr 04, 202020</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    10 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <hr>
<p><br />  <br /></p>
<h2 id="절두체-컬링">절두체 컬링</h2>
<ul>
<li><strong>절두체 컬링(Frustum culling)</strong>
<ul>
<li>절두체를 구성하는 6개의 평면에 대해 각각 평면의 방정식을 세우고, 그것을 활용해서 게임 오브젝트가 평면의 바깥에 있는지 확인한다.</li>
<li>바깥에 있다면, 그리지 않는다.</li>
</ul>
</li>
</ul>
<br />  
<h3 id="평면의-방정식">평면의 방정식</h3>
<ul>
<li>
<p>절두체를 구성하는 평면의 방정식</p>
<ul>
<li>Chapter 8에서 살펴본 것처럼, 주어진 세 점으로 두 벡터를 생성해서 평면 상의 모든 점을 생성할 수 있다.</li>
<li>하지만 3차원 공간의 평면은 앞면과 뒷면이 존재하기 때문에 이를 구분할 수 있어야 하겠다.</li>
<li>따라서 <strong>평면이 바라보는 방향을 알려주는 법선 벡터</strong>와 <strong>평면 상에 위치한 한 점</strong>을 제공하는 방법을 사용한다. 이 때 <strong>법선 벡터는 크기를 1로 정규화</strong>한다. <br /><br>
<img src="/postimg/gamemath/13-01-plane.jpg"
	
	
	
	loading="lazy"
	
		alt="평면을 이루는 최소 구성 요소"
	
	
></li>
</ul>
</li>
<li>
<p>법선벡터와 평면 위의 두 점을 지나는 벡터는 <strong>서로 직교</strong>하기 때문에 <span style='background-color: #c293d8'>두 벡터의 내적은 $0$</span>이 된다.</p>
<ul>
<li>따라서 법선벡터 $\hat{n} = (a, b, c)$와 점 $P_0 = (x_0, y_0, z_0)$에서 $P = (x, y, z)$로 향하는 벡터를 내적하면 다음과 같다.</li>
<li>$$ \hat{n} \cdot (P - P_0) = (a, b, c) \cdot (x - x_0, y - y_0, z - z_0) = 0 $$
$$ = ax + by + cz - (ax_0 + by_0 + cz_0) = 0 $$</li>
<li>여기서 법선벡터 $\hat{n} = (a, b, c)$와 점 $P_0 = (x_0, y_0, z_0)$은 사전에 주어진 값이므로 $- (ax_0 + by_0 + cz_0)$는 미리 계산할 수 있는 상수 값이다. 이것을 간단히 $d$로 치환하면 다음과 같다.</li>
</ul>
</li>
</ul>
<br />  
<ul>
<li><strong>평면의 방정식(The equation of plane)</strong>
<ul>
<li><span style='background-color: #c293d8'>$$ ax + by + cz + d = 0 $$</span></li>
</ul>
</li>
</ul>
<br />  
<ul>
<li>여기서 $d$의 의미를 찾아보자.
<ul>
<li>$$d = -(ax_0 + by_0 + cz_0)$$
$$ d = -\hat{n} \cdot (x_0, y_0, z_0)$$
$$ d = -\hat{n} \cdot \vec{OP_0} = -\hat{n} \cdot \vec{p}$$ <br />
<img src="/postimg/gamemath/13-02-dot.jpg"
	
	
	
	loading="lazy"
	
		alt="상수 d와 관련된 두 벡터 내적의 의미"
	
	
></li>
<li>그렇다면 $\hat{n} \cdot \vec{p}$는 무엇을 의미할까?
<ul>
<li>Chapter 7에서 배운 벡터 내적의 $\cos$공식을 떠올려보자.</li>
<li>$\hat{n} \cdot \vec{p} = | \hat{n} | | \vec{p} | \cos\theta$</li>
<li>법선 벡터의 크기는 $1$이므로 다음과 같이 정리된다.</li>
<li>$\hat{n} \cdot \vec{p} = | \vec{p} | \cos\theta$</li>
<li>따라서 $\hat{n} \cdot \vec{p}$이란 $\vec{p}$벡터를 법선 벡터 $\hat{n}$에 투영한 벡터의 크기를 의미한다.</li>
<li>즉, <strong>원점에서 평면까지의 최단 거리</strong>인 것이다.</li>
</ul>
</li>
<li>$d$의 값은 마이너스를 붙인 $-\hat{n} \cdot \vec{p}$이므로 원점으로부터 평면의 최단 거리에 음의 부호를 설정한다.</li>
<li>그래서 $d$는 <span style='background-color: #c293d8'>최단 거리</span>와 <span style='background-color: #c293d8'>방향</span>이라는 두 가지 정보를 담고 있다.</li>
</ul>
</li>
</ul>
<br />  
<ul>
<li><strong>$d$의 부호</strong>
<ul>
<li>$d$의 값이 <strong>양수</strong>이다.
<ul>
<li>평면이 바라보는 방향은 원점을 향한다.</li>
<li>즉, 원점은 평면의 <strong>바깥</strong>에 있다.</li>
</ul>
</li>
<li>$d$의 값이 <strong>음수</strong>이다.
<ul>
<li>평면이 바라보는 방향은 원점에서 멀어지는 방향을 가진다.</li>
<li>즉, 원점은 평면의 <strong>안쪽</strong>에 있다.</li>
</ul>
</li>
</ul>
</li>
<li><strong>$d$의 절댓값</strong>
<ul>
<li>평면에서 원점까지의 <strong>최단 거리</strong>.</li>
</ul>
</li>
<li><strong>$d$의 값이 $0$</strong> 이다.
<ul>
<li>평면이 원점을 품었다.</li>
</ul>
</li>
</ul>
<br />  
<ul>
<li><strong>주어진 점이 평면의 안쪽에 있는지 바깥쪽에 있는지 판별하기.</strong>
<ul>
<li>$d$값의 성질을 응용해보자. <br /><br>
<img src="/postimg/gamemath/13-03-inOut.jpg"
	
	
	
	loading="lazy"
	
		alt="점의 내부 외부 판별"
	
	
></li>
<li>위 그림과 같이 벡터 $\vec{p}$를 법선 벡터에 내적한 값을 $p$라고 하자.
<ul>
<li>$p$가 양수면? 벡터 $\vec{p}$는 법선 벡터와 같은 방향을 향한다.</li>
<li>$p$가 음수면? 벡터 $\vec{p}$는 법선 벡터와 반대 방향을 향한다.</li>
<li>위 그림에서는 $p$가 양수이겠다.</li>
</ul>
</li>
<li>그렇다면 $p$와 $d$를 더한 값은 어떨까?
<ul>
<li>$p + d$가 음수면? 점 $P$는 평면의 안쪽에 있다.</li>
<li>$p + d$가 양수면? 점 $P$는 평면의 바깥쪽에 있다.</li>
</ul>
</li>
<li>따라서 법선 벡터 $(a, b, c)$와 $d$를 사용해 주어진 점 $P = (x_1, y_1, z_1)$이 <strong>평면의 바깥쪽에 있는지 판단</strong>하는 수식은 다음과 같다.
<ul>
<li><span style='background-color: #c293d8'>$$(a, b, c) \cdot (x_1, y_1, z_1) + d &gt; 0 $$</span></li>
</ul>
</li>
<li>그리고 <strong>평면에서 해당 점까지의 최단 거리</strong>는 다음과 같다.
<ul>
<li><span style='background-color: #c293d8'>$$distance = |(a, b, c) \cdot (x_1, y_1, z_1) + d | $$</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<br />  
<h3 id="평면의-방정식의-정규화">평면의 방정식의 정규화</h3>
<ul>
<li>크기가 $1$이 아닌 주어진 법선 벡터를 구성하는 세 계수 $(a, b, c)$를 <strong>정규화</strong>해서 $(a&rsquo;, b&rsquo;, c&rsquo;)$를 만들어 보자.
<ul>
<li>이것은 법선 벡터의 크기로 나누면 구할 수 있다.</li>
<li>$$ (a&rsquo;, b&rsquo;, c&rsquo;) = \frac{(a, b, c)}{\sqrt{a^2 + b^2 + c^2}} $$</li>
</ul>
</li>
<li>$d$를 정규화한 $d&rsquo;$를 만들어 보자.
<ul>
<li>$$ d = -\hat{n} \cdot \vec{p} = - |\hat{n}||\vec{p}|\cos\theta $$</li>
<li>$$ d&rsquo; = -|\vec{p}|\cos\theta $$</li>
<li>따라서 다음과 같은 관계가 나온다.</li>
<li>$$ d&rsquo; = \frac{d}{|\vec{n}|} $$</li>
<li>즉, $d$의 경우에도 동일하게 법선 벡터의 크기로 나누면 되는 것이다.</li>
<li>$$ \frac{ax + by + cz + d}{\sqrt{a^2 + b^2 + c^2}} = 0 $$</li>
</ul>
</li>
</ul>
<br />  
<ul>
<li><strong>2차원 직선의 방정식에서의 최단 거리</strong>
<ul>
<li>임의의 한 점 $(x_1, y_1)$에서 임의의 직선 $ax + by + c = 0$ 까지의 최단 거리는 어떻게 구할 수 있을까? <br /><br>
<img src="/postimg/gamemath/13-04-shortestDistance.jpg"
	
	
	
	loading="lazy"
	
		alt="직선과 점 사이의 최단 거리"
	
	
></li>
<li>평면의 방정식을 정규화한 값과 내적을 활용해 구할 수 있겠다.</li>
<li>$$ \frac{ | ax_1 + by_1 + c | }{ \sqrt{a^2 + b^2 } } $$</li>
</ul>
</li>
</ul>
<br />  
<h3 id="평면의-방정식을-활용한-절두체-표현">평면의 방정식을 활용한 절두체 표현</h3>
<ul>
<li>절두체 상단 평면을 무한하게 확장하면, 그 평면은 원점을 품게 된다.
<ul>
<li>이것은 근평면, 원평면을 제외한 나머지 평면에 대해서도 동일하다.</li>
<li>따라서 근평면, 원평면을 제외한 나머지 평면을 구성하는 평면의 방정식 $d$값은 $0$이겠다.</li>
</ul>
</li>
<li>상단 평면의 경우 아래 그림과 같이 구할 수 있으므로, 같은 방식으로 네 평면의 방정식을 구할 수 있다. <br /><br>
<img src="/postimg/gamemath/13-05-cam.jpg"
	
	
	
	loading="lazy"
	
		alt="절두체 상단 평면의 법선 벡터를 구하는 과정"
	
	
>
<ul>
<li>절두체 <strong>상단</strong> 평면의 방정식
<ul>
<li>$$ \cos\frac{\theta}{2}y + \sin\theta\frac{\theta}{2}z = 0 $$</li>
</ul>
</li>
<li>절두체 <strong>하단</strong> 평면의 방정식
<ul>
<li>$$ -\cos\frac{\theta}{2}y + \sin\theta\frac{\theta}{2}z = 0 $$</li>
</ul>
</li>
<li>절두체 <strong>좌측</strong> 평면의 방정식
<ul>
<li>$$ \cos\frac{\theta}{2}x + \sin\theta\frac{\theta}{2}z = 0 $$</li>
</ul>
</li>
<li>절두체 <strong>우측</strong> 평면의 방정식
<ul>
<li>$$ -\cos\frac{\theta}{2}x + \sin\theta\frac{\theta}{2}z = 0 $$</li>
</ul>
</li>
</ul>
</li>
<li><strong>근평면</strong>의 경우, 원점으로부터의 거리는 $n$이므로, 평면의 방정식의 $d$의 값은 $n$이 된다. 그리고 법선 벡터의 값은 $(0, 0, 1)$이 된다.
<ul>
<li>$$(0, 0, 1) \cdot (x, y, z) - (0, 0, 1) \cdot (0, 0, -n) = 0 $$</li>
<li>$$ \therefore z + n = 0 $$</li>
</ul>
</li>
<li><strong>원평면</strong>의 경우에는 거리가 $f$가 되며, 법선 벡터의 값은 $(0, 0, -1)$이 된다.
<ul>
<li>$$(0, 0, -1) \cdot (x, y, z) - (0, 0, 1) \cdot (0, 0, f) = 0 $$</li>
<li>$$ \therefore -z -f = 0 $$</li>
<li>이 때, <strong>함부로 수식을 옮기면 안 된다.</strong> 만약 $0 = z + f$와 같이 옮긴다면, 평면의 방향은 원평면의 반대 방향인 원점을 향한다. 따라서 $-z -f = 0 $와 $0 = z + f$는 <strong>서로 다른 평면</strong>이다.</li>
</ul>
</li>
</ul>
<br />  
<h3 id="원근-투영-행렬로부터-평면의-방정식-만들기">원근 투영 행렬로부터 평면의 방정식 만들기</h3>
<ul>
<li><strong>원근 투영 행렬</strong>을 사용해서 절두체 컬링을 좀 더 간편하게 구현할 수 있다.
<ul>
<li>뷰 공간의 점이 NDC좌표까지 변환됐을 때, NDC좌표를 구성하는 $x$, $y$, $z$ 세 축의 값이 $[-1, 1]$ 범위에 있다면 해당 점은 절두체 영역 안 쪽에 있다는 것을 의미한다.</li>
<li>$$ -1 \leq n_x \leq 1 $$
$$ -1 \leq n_y \leq 1 $$
$$ -1 \leq n_z \leq 1 $$</li>
<li>이 때 NDC좌표는 클립 좌표의 마지막 차원 $w$로 나눈 결과값이므로 다음과 같다.</li>
<li>$$ -1 \leq \frac{x}{w} \leq 1 $$
$$ -1 \leq \frac{y}{w} \leq 1 $$
$$ -1 \leq \frac{z}{w} \leq 1 $$</li>
<li>$$ -w \leq x \leq w $$
$$ -w \leq y \leq w $$
$$ -w \leq z \leq w $$</li>
</ul>
</li>
<li>여기서 $x$, $y$, $z$란?
<ul>
<li>$$ P \cdot \vec{v} = \begin{bmatrix} \frac{d}{a} &amp; 0 &amp; 0 &amp; 0\\ 0 &amp; d &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; \frac{n + f}{n - f} &amp; \frac{2nf}{n - f} \\ 0 &amp; 0 &amp; -1 &amp; 0 \end{bmatrix} \begin{bmatrix} v_x \\ v_y \\ v_z \\ 1  \end{bmatrix} = \begin{bmatrix} x \\ y \\ z \\ w \end{bmatrix} $$</li>
<li>이것은 원근 투영 행렬의 4개의 행벡터와 $\vec{v}$의 내적으로 바꿔 쓸 수 있다.</li>
<li>$$ \begin{bmatrix} P_{row1} \cdot \vec{v} \\ P_{row2} \cdot \vec{v} \\ P_{row3} \cdot \vec{v} \\ P_{row4} \cdot \vec{v} \end{bmatrix} = \begin{bmatrix} x \\ y \\ z \\ w \end{bmatrix} $$</li>
<li>이것을 부등식에 치환하면 다음과 같다.</li>
<li>$$ -P_{row4} \cdot \vec{v} \leq P_{row1} \cdot \vec{v} \leq P_{row4} \cdot \vec{v} $$
$$ -P_{row4} \cdot \vec{v} \leq P_{row2} \cdot \vec{v} \leq P_{row4} \cdot \vec{v} $$
$$ -P_{row4} \cdot \vec{v} \leq P_{row3} \cdot \vec{v} \leq P_{row4} \cdot \vec{v} $$</li>
<li>이것을 분리해 6개의 부등식으로 표현할 수 있겠다.</li>
<li>$$ (P_{row4} + P_{row1} \cdot \vec{v}) \geq 0 $$
$$ (P_{row4} - P_{row1} \cdot \vec{v}) \geq 0 $$
$$ (P_{row4} + P_{row2} \cdot \vec{v}) \geq 0 $$
$$ (P_{row4} - P_{row2} \cdot \vec{v}) \geq 0 $$
$$ (P_{row4} + P_{row3} \cdot \vec{v}) \geq 0 $$
$$ (P_{row4} - P_{row3} \cdot \vec{v}) \geq 0 $$</li>
<li><span style='background-color: #c293d8'>이 부등식이 모두 참이면 점 $\vec{v}$는 절두체 영역 내부에 있음</span>을 의미한다.</li>
</ul>
</li>
<li>여기서 행벡터가 $P_{rown} = (a, b, c, d)$라고 하고, 뷰 공간의 점이 $\vec{v} = (x, y, z, 1)$라고 할 때 내적의 결과는 다음과 같다.
<ul>
<li>$$ ax + by + cz + d \geq 0 $$</li>
<li>하지만 법선벡터 $(a, b, c)$의 크기가 $1$이 아니므로, 정규화 해야 한다.</li>
<li>$$ \frac{ ax + by + cz + d }{ \sqrt{ a^2 + b^2 + c^2 } } = 0 $$</li>
<li>이 결과는 모두 절두체 내부를 향할 것이다. 따라서 <strong>외부에 있는지를 검출</strong>하기 위해서는 <strong>부호를 반전시켜 주어야</strong> 한다.</li>
<li>$$ - ( \frac{ ax + by + cz + d }{ \sqrt{ a^2 + b^2 + c^2 } } ) &gt; 0 $$</li>
</ul>
</li>
</ul>
<br />  
<ul>
<li>원근 투영 행렬을 사용해서 절두체 컬링하는 예제이다.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Plane</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">FORCEINLINE</span> <span class="k">constexpr</span> <span class="kt">float</span> <span class="n">Distance</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector3</span><span class="o">&amp;</span> <span class="n">InPoint</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">FORCEINLINE</span> <span class="k">constexpr</span> <span class="kt">bool</span> <span class="nf">IsOutside</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector3</span><span class="o">&amp;</span> <span class="n">InPoint</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">Vector3</span> <span class="n">Normal</span> <span class="o">=</span> <span class="n">Vector3</span><span class="o">::</span><span class="n">UnitY</span><span class="p">;</span>  <span class="c1">// (a, b, c)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">D</span> <span class="o">=</span> <span class="mf">0.f</span><span class="p">;</span>  <span class="c1">// 상수 d의 값
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Plane</span><span class="o">::</span><span class="n">Plane</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector4</span><span class="o">&amp;</span> <span class="n">InVector4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Normal</span> <span class="o">=</span> <span class="n">InVector4</span><span class="p">.</span><span class="n">ToVector3</span><span class="p">();</span>  <span class="c1">// (a, b, c)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">D</span> <span class="o">=</span> <span class="n">InVector4</span><span class="p">.</span><span class="n">W</span><span class="p">;</span>  <span class="c1">// 상수 d의 값
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Normalize</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 정규화 한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="n">Plane</span><span class="o">::</span><span class="n">Normalize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// a^2 + b^2 + c^2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">squaredSize</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">.</span><span class="n">SizeSquared</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 크기가 1이면 정규화할 필요 없다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">Math</span><span class="o">::</span><span class="n">EqualsInTolerance</span><span class="p">(</span><span class="n">squaredSize</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 1 / sqrt(a^2 + b^2 + c^2)을 고속 역제곱근(Fast inverse square root) 함수로 구한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="n">invLength</span> <span class="o">=</span> <span class="n">Math</span><span class="o">::</span><span class="n">InvSqrt</span><span class="p">(</span><span class="n">squaredSize</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// 곱해서 정규화한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Normal</span> <span class="o">*=</span> <span class="n">invLength</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">D</span> <span class="o">*=</span> <span class="n">invLength</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// p + d를 리턴한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">FORCEINLINE</span> <span class="k">constexpr</span> <span class="kt">float</span> <span class="n">Plane</span><span class="o">::</span><span class="n">Distance</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector3</span><span class="o">&amp;</span> <span class="n">InPoint</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Normal</span><span class="p">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">InPoint</span><span class="p">)</span> <span class="o">+</span> <span class="n">D</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Distance의 반환값이 양수이면 그 점은 평면의 바깥에 있다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">FORCEINLINE</span> <span class="k">constexpr</span> <span class="kt">bool</span> <span class="n">Plane</span><span class="o">::</span><span class="n">IsOutside</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector3</span><span class="o">&amp;</span> <span class="n">InPoint</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">Distance</span><span class="p">(</span><span class="n">InPoint</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="k">constexpr</span> <span class="n">BoundCheckResult</span> <span class="n">Frustum</span><span class="o">::</span><span class="n">CheckBound</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector3</span><span class="o">&amp;</span> <span class="n">InPoint</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 6개의 평면에 대해 테스트를 진행한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">p</span> <span class="p">:</span> <span class="n">Planes</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 한 평면이라도 밖에 있으면 점은 외부에 있음으로 판별하고 함수를 종료한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">IsOutside</span><span class="p">(</span><span class="n">InPoint</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">BoundCheckResult</span><span class="o">::</span><span class="n">Outside</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 오차 범위 내의 거리가 0에 근접하면 겹치는 것으로 판별하고 종료한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">Math</span><span class="o">::</span><span class="n">EqualsInTolerance</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">Distance</span><span class="p">(</span><span class="n">InPoint</span><span class="p">),</span> <span class="mf">0.f</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">BoundCheckResult</span><span class="o">::</span><span class="n">Intersect</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 모든 평면에 대해 위 테스트를 통과하면 안쪽으로 판별한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">BoundCheckResult</span><span class="o">::</span><span class="n">Inside</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// 렌더링 로직을 담당하는 함수
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="n">SoftRenderer</span><span class="o">::</span><span class="n">Render3D</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 렌더링 로직에서 사용하는 모듈 내 주요 레퍼런스
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="n">GameEngine</span><span class="o">&amp;</span> <span class="n">g</span> <span class="o">=</span> <span class="n">Get3DGameEngine</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">auto</span><span class="o">&amp;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">GetRenderer</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">CameraObject</span><span class="o">&amp;</span> <span class="n">mainCamera</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">GetMainCamera</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 배경에 기즈모 그리기
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">DrawGizmo3D</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 렌더링 로직의 로컬 변수
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="n">Matrix4x4</span> <span class="n">vMatrix</span> <span class="o">=</span> <span class="n">mainCamera</span><span class="p">.</span><span class="n">GetViewMatrix</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">Matrix4x4</span> <span class="n">pMatrix</span> <span class="o">=</span> <span class="n">mainCamera</span><span class="p">.</span><span class="n">GetPerspectiveMatrix</span><span class="p">();</span>  <span class="c1">// 원근 투영 행렬을 가져온다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="n">Matrix4x4</span> <span class="n">pvMatrix</span> <span class="o">=</span> <span class="n">mainCamera</span><span class="p">.</span><span class="n">GetPerspectiveViewMatrix</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 절두체 구축을 위한 투영 행렬의 설정
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Matrix4x4</span> <span class="n">ptMatrix</span> <span class="o">=</span> <span class="n">pMatrix</span><span class="p">.</span><span class="n">Transpose</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 절두체를 구성하는 평면의 방정식
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 절두체를 구성하는 6개의 평면을 생성한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">Plane</span><span class="p">,</span> <span class="mi">6</span><span class="o">&gt;</span> <span class="n">frustumPlanes</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Plane</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">ptMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">ptMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="c1">// +Y
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Plane</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">ptMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">ptMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="c1">// -Y
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Plane</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">ptMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">ptMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="c1">// +X
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Plane</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">ptMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">ptMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="c1">// -X
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Plane</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">ptMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">ptMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">])),</span> <span class="c1">// +Z
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Plane</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">ptMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">ptMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">])),</span> <span class="c1">// -Z
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 절두체 선언 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Frustum</span> <span class="nf">frustumFromMatrix</span><span class="p">(</span><span class="n">frustumPlanes</span><span class="p">);</span> <span class="c1">// 평면의 배열을 인자로 넣어 절두체를 구축한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 절두체 컬링 테스트를 위한 통계 변수 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">size_t</span> <span class="n">totalObjects</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">GetScene</span><span class="p">().</span><span class="n">size</span><span class="p">();</span> <span class="c1">// 씬에 속한 전체 게임 오브젝트 수를 파악한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">size_t</span> <span class="n">culledObjects</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// 렌더링이 진행된 게임 오브젝트 수를 파악한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">size_t</span> <span class="n">renderedObjects</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// 렌더링이 진행된 게임 오브젝트 수를 파악한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">SceneBegin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">g</span><span class="p">.</span><span class="n">SceneEnd</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">GameObject</span><span class="o">&amp;</span> <span class="n">gameObject</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">gameObject</span><span class="p">.</span><span class="n">HasMesh</span><span class="p">()</span> <span class="o">||</span> <span class="o">!</span><span class="n">gameObject</span><span class="p">.</span><span class="n">IsVisible</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 렌더링에 필요한 게임 오브젝트의 주요 레퍼런스를 얻기
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">const</span> <span class="n">Mesh</span><span class="o">&amp;</span> <span class="n">mesh</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">GetMesh</span><span class="p">(</span><span class="n">gameObject</span><span class="p">.</span><span class="n">GetMeshKey</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">TransformComponent</span><span class="o">&amp;</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">gameObject</span><span class="p">.</span><span class="n">GetTransform</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 절두체 컬링 구현
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// 게임 오브젝트의 위치를 뷰 공간으로 변환한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Vector4</span> <span class="n">viewPos</span> <span class="o">=</span> <span class="n">vMatrix</span> <span class="o">*</span> <span class="n">Vector4</span><span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">GetPosition</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1">// 뷰 공간의 위치가 절두체 영역의 외부에 있는지 검사한다. 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="n">frustumFromMatrix</span><span class="p">.</span><span class="n">CheckBound</span><span class="p">(</span><span class="n">viewPos</span><span class="p">.</span><span class="n">ToVector3</span><span class="p">())</span> <span class="o">==</span> <span class="n">BoundCheckResult</span><span class="o">::</span><span class="n">Outside</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 그리지 않고 건너뜀
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">culledObjects</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 최종 행렬 계산
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Matrix4x4</span> <span class="n">finalMatrix</span> <span class="o">=</span> <span class="n">pvMatrix</span> <span class="o">*</span> <span class="n">transform</span><span class="p">.</span><span class="n">GetModelingMatrix</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 메시 그리기
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">DrawMesh3D</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">finalMatrix</span><span class="p">,</span> <span class="n">gameObject</span><span class="p">.</span><span class="n">GetColor</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 그린 물체를 통계에 포함
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">renderedObjects</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="p">.</span><span class="n">PushStatisticText</span><span class="p">(</span><span class="s">&#34;Total GameObjects : &#34;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">totalObjects</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="p">.</span><span class="n">PushStatisticText</span><span class="p">(</span><span class="s">&#34;Culled GameObjects : &#34;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">culledObjects</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span><span class="p">.</span><span class="n">PushStatisticText</span><span class="p">(</span><span class="s">&#34;Rendered GameObjects : &#34;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">renderedObjects</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><br />  <br /></p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/game-math/">Game Math</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css"integrity="sha256-J&#43;iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s="crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js"integrity="sha256-InsNdER1b2xUewP&#43;pKCUJpkhiqwHgqiPXDlIk7GzBu4="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js"integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI="crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/game-math-14/">
        
        

        <div class="article-details">
            <h2 class="article-title">[Game Math] Chapter 14. 복소수: 2차원 평면의 수</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/game-math-13-2/">
        
        

        <div class="article-details">
            <h2 class="article-title">[Game Math] Chapter 13. 절두체: 최적화된 3차원 공간 (2) </h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/game-math-12/">
        
        

        <div class="article-details">
            <h2 class="article-title">[Game Math] Chapter 12. 원근 투영: 화면에 현실감을 부여하는 변환</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/game-math-11/">
        
        

        <div class="article-details">
            <h2 class="article-title">[Game Math] Chapter 11. 외적: 3차원 공간의 분석과 응용</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/game-math-10/">
        
        

        <div class="article-details">
            <h2 class="article-title">[Game Math] Chapter 10. 3차원 공간: 입체 공간의 생성</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2022 Sopod
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.12.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#절두체-컬링">절두체 컬링</a>
      <ol>
        <li><a href="#평면의-방정식">평면의 방정식</a></li>
        <li><a href="#평면의-방정식의-정규화">평면의 방정식의 정규화</a></li>
        <li><a href="#평면의-방정식을-활용한-절두체-표현">평면의 방정식을 활용한 절두체 표현</a></li>
        <li><a href="#원근-투영-행렬로부터-평면의-방정식-만들기">원근 투영 행렬로부터 평면의 방정식 만들기</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
